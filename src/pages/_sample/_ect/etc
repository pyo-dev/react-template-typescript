import React, { useRef, useEffect } from "react";
import Highcharts from "highcharts";
import HighchartsReact from "highcharts-react-official";

const ChartZoomWheel: React.FC = () => {
  const chartRef = useRef<HighchartsReact.RefObject>(null);

  const options: Highcharts.Options = {
    chart: {
      type: "column",
      zoomType: "xy", // 드래그 박스 줌 가능
    },
    title: { text: "Mouse Wheel Zoom X & Y" },
    xAxis: {
      categories: Array.from({ length: 50 }, (_, i) => `Cat ${i + 1}`),
    },
    yAxis: { title: { text: "Value" } },
    series: [
      {
        type: "column",
        data: Array.from({ length: 50 }, () => Math.floor(Math.random() * 100)),
      },
    ],
  };

  useEffect(() => {
    const chart = chartRef.current?.chart;
    if (!chart) return;

    const handleWheel = (e: WheelEvent) => {
      e.preventDefault();

      const zoomFactor = 0.2; // 확대/축소 비율

      // X축 확대/축소
      const xAxis = chart.xAxis[0];
      const xExt = xAxis.getExtremes();
      const xRange = xExt.max - xExt.min;
      let newXMin = xExt.min + (e.deltaY > 0 ? xRange * zoomFactor / 2 : -xRange * zoomFactor / 2);
      let newXMax = xExt.max - (e.deltaY > 0 ? xRange * zoomFactor / 2 : -xRange * zoomFactor / 2);
      if (newXMin < xExt.dataMin) newXMin = xExt.dataMin;
      if (newXMax > xExt.dataMax) newXMax = xExt.dataMax;
      if (newXMax - newXMin < 1) return; // 최소 범위 제한

      xAxis.setExtremes(newXMin, newXMax, true, false);

      // Y축 확대/축소
      const yAxis = chart.yAxis[0];
      const yExt = yAxis.getExtremes();
      const yRange = yExt.max - yExt.min;
      let newYMin = yExt.min + (e.deltaY > 0 ? yRange * zoomFactor / 2 : -yRange * zoomFactor / 2);
      let newYMax = yExt.max - (e.deltaY > 0 ? yRange * zoomFactor / 2 : -yRange * zoomFactor / 2);
      if (newYMin < yExt.dataMin) newYMin = yExt.dataMin;
      if (newYMax > yExt.dataMax) newYMax = yExt.dataMax;
      if (newYMax - newYMin < 1) return;

      yAxis.setExtremes(newYMin, newYMax, true, false);
    };

    const container = chart.container;
    container.addEventListener("wheel", handleWheel);

    return () => container.removeEventListener("wheel", handleWheel);
  }, []);

  return <HighchartsReact ref={chartRef} highcharts={Highcharts} options={options} />;
};

export default ChartZoomWheel;
